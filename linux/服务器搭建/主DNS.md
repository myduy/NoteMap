##### 1. 修改主机名

```shell
hostnamectl set-hostname master
hostnamectl
```

> 修改主机名需要重新登入生效

##### 2. 安装DNS服务组件

```shell
yum install bind-chroot bind-utils -y
```

> 如果安装失败
>
> 卸载新版本重新安装
>
> ```shell
> # 查询系统已经安装的软件
> rpm -qa |grep audis
> # 降级
> rpm -Uvh -oldpackage [rpm名称] --nodeps
> ```

##### 3. 拷贝 bind 相关文件，准备 bind-chroot 环境

```shell
cp -R /usr/share/doc/bind-版本号/sample/etc/* /var/named/chroot/etc
cp -R /usr/share/doc/bind-版本号/sample/var/* /var/named/chroot/var
```

##### 4. 给与 data 目录 777 权限，并创建 dynamic 目录，给与 777 权限

```shell
chmod -R 777 /var/named/chroot/var/named/data/
mkdir -p /var/named/chroot/varnamed/data/dynamic
chmod -R 777 /var/named/chroot/varnamed/data/dynamic
```

##### 5. 将 DNS 服务 named.conf 文件拷贝到/var/named/chroot/etc 目录中，覆盖原有的 named.conf 文件

```shell
cp /etc/named.conf /var/named/chroot/etc/named.conf
```

编辑配置文件 named.conf

```shell
vi /var/named/chroot/etc/named.conf
```

```shell
//
// named.conf
//
//
// named.conf
//
// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
// server as a caching only nameserver (as a localhost DNS resolver only).
//
// See /usr/share/doc/bind*/sample/ for example named configuration files.
//
// See the BIND Administrator's Reference Manual (ARM) for details about the
// configuration located in /usr/share/doc/bind-{version}/Bv9ARM.html

options {
//##########
        listen-on port 53 { any; };
//##########
        listen-on-v6 port 53 { ::1; };
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        recursing-file  "/var/named/data/named.recursing";
        secroots-file   "/var/named/data/named.secroots";
//###################        
        allow-query     { any; };  //修改为任何ip可访问
//###################
        /*
         - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
         - If you are building a RECURSIVE (caching) DNS server, you need to enable
           recursion.
         - If your recursive DNS server has a public IP address, you MUST enable access
           control to limit queries to your legitimate users. Failing to do so will
           cause your server to become part of large scale DNS amplification
           attacks. Implementing BCP38 within your network would greatly
           reduce such attack surface
        */
        recursion yes;

        dnssec-enable yes;
        dnssec-validation yes;

        /* Path to ISC DLV key */
        bindkeys-file "/etc/named.root.key";

        managed-keys-directory "/var/named/dynamic";

        pid-file "/run/named/named.pid";
        session-keyfile "/run/named/session.key";
};

logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
};

/*
zone "." IN {
        type hint;
        file "named.ca";
};
*/

//###################
zone "test.com" {
	type master;
	file "test.com.zon";
};
//###################

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";
```

##### 6. 设置 named.conf 文件的用户组为 named

```shell
chown named /var/named/chroot/etc/named.conf
```

创建转发域。拷贝模板文件 named.localhost 到 test.com.zon

```shell
cp /var/named/named.localhost /var/named/chroot/var/named/test.com.zon
```

##### 7. 编辑 test.com.zon 文件

```shell
vi /var/named/chroot/var/named/test.com.zon
```

```shell
$TTL 1D
$ORIGIN test.com.
@       IN SOA  test.com. admin.test.com. (
                                        2019001 ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H      ; minimum
)                                        
	IN NS www.test.com.
www	IN A	180.101.49.11	//此ip为百度网站ip，用来测试域名解析
```

##### 8. 赋予 test.com.zon 所有权限

```shell
chmod 777 /var/named/chroot/var/named/test.com.zon
```

##### 9.检查配置

```shell
named-checkconf /var/named/chroot/etc/named.conf
named-checkzone test.com test.com.zon
```

##### 10.关闭named服务取消开机启动

```
systemctl stop named
systemctl disable named
```

##### 11.设置 bind-chroot 服务开机启动，并重启

```
systemctl start named-chroot
systemctl enable named-chroot
```

##### 12. 配置主机 DNS 服务器

```
vi /etc/resolv.conf
```

```shell
# Generated by NetworkManager
search openstacklocal
nameserver #内网ip
options single-request-reopen
```

##### 13. 使用 bind 基本命令重载主配置文件和区域解析库文件

```shell
rndc reload
rndc reload test.com
rndc notify test.com
rndc reconfig
#测试 DNS 解析是否正常
ping www.test.com
```

