### Perl 格式化输出

Perl 是一个非常强大的文本数据处理语言。

Perl 中可以使用 format 来定义一个模板，然后使用 write 按指定模板输出数据。

Perl 格式化定义语法格式如下：

```perl
format FormatName =
fieldline
value_one, value_two, value_three
fieldline
value_one, value_two
.
```

| 参数                      | 描述                                                         |
| ------------------------- | ------------------------------------------------------------ |
| **FormatName**            | 格式化名称                                                   |
| **fieldline**             | 一个格式行，用来定义一个输出行的格式,类似 @,^,<,>,\|这样的字符。 |
| **value_one,value_two……** | 数据行，用来向前面的格式行中插入值,都是perl的变量            |
| **.**                     | 结束符号                                                     |

### 格式化实例

```perl
$text = "google runoob taobao";
format STDOUT =
first: ^<<<<<  # 左边对齐，字符长度为6
    $text
second: ^<<<<< # 左边对齐，字符长度为6
    $text
third: ^<<<< # 左边对齐，字符长度为5，taobao 最后一个 o 被截断
    $text  
.
write
```

| 符号                | 作用                                                    |
| ------------------- | ------------------------------------------------------- |
| @ 或者 ^ 开头       | 格式行                                                  |
| @                   | 字段是普通的字段                                        |
| @,^ 后 <, >,\| 长度 | 决定了字段的长度，如果变量超出定义的长度,那么它将被截断 |
| <, >,\|             | 左对齐,右对齐,居中对齐                                  |
| ^字段               | 用于多行文本块填充                                      |

### 值域格式

| 格式    | 值域含义     |
| ------- | ------------ |
| @<<<    | 左对齐输出   |
| @>>>    | 右对齐输出   |
| @\|\|\| | 中对齐输出   |
| @##.##  | 固定精度数字 |
| @*      | 多行文本     |

```perl
format EMPLOYEE =
===================================
@<<<<<<<<<<<<<<<<<<<<<< @<< 
$name, $age
@#####.##
$salary
===================================
.

select(STDOUT);
$~ = EMPLOYEE;
 
@n = ("Ali", "baidu", "Jaffer");
@a  = (20,30, 40);
@s = (2000.00, 2500.00, 4000.000);
 
$i = 0;
foreach (@n){
    $name = $_;
    $age = $a[$i];
    $salary = $s[$i++];
    write;
}
```

#### 格式变量
|	格式	|	描述	|
| ---- | ---- |
| $~ ($FORMAT_NAME) | 格式名字 $^ ($FORMAT_TOP_NAME) 当前的表头格式名字存储在 |
| $% ($FORMAT_PAGE_NUMBER)  | 当前输出的页号 |
| $= ($FORMAT_LINES_PER_PAGE) | 每页中的行数 |
| $| ($FORMAT_AUTOFLUSH) | 是否自动刷新输出缓冲区存储 |
| $^L ($FORMAT_FORMFEED)  | 在每一页(除了第一页)表头之前需要输出的字符串存储在 |

```perl
$~ = "MYFORMAT"; # 指定默认文件变量下所使用的格式
write;           # 输出 $~ 所指定的格式
 
format MYFORMAT = # 定义格式 MYFORMAT 
=================================
      Text # 文本
=================================
.
write;
```

如果不指定$~的情况下，会输出名为STDOUT的格式：

```perl
write;         # 不指定$~的情况下会寻找名为STDOUT的格式
 
format STDOUT =
~用~号指定的文字不会被输出
----------------
  STDOUT格式
----------------
.
```

添加报表头部信息来演示 $^ 或 $FORMAT_TOP_NAME 变量的使用：

```perl
format EMPLOYEE =
===================================
@<<<<<<<<<<<<<<<<<<<<<< @<< 
$name, $age
@#####.##
$salary
===================================
.
 
format EMPLOYEE_TOP =
===================================
Name                    Age
===================================
.
 
select(STDOUT);
$~ = EMPLOYEE;
$^ = EMPLOYEE_TOP; #在每一页(除了第一页)表头之前需要输出的字符串存储在
 
@n = ("Ali", "baidu", "Jaffer");
@a  = (20,30, 40);
@s = (2000.00, 2500.00, 4000.000);
 
$i = 0;
foreach (@n){
   $name = $_;
   $age = $a[$i];
   $salary = $s[$i++];
   write;
}
```

使用 $% 或 $FORMAT_PAGE_NUMBER 为报表设置分页

```perl
format EMPLOYEE =
===================================
@<<<<<<<<<<<<<<<<<<<<<< @<< 
$name, $age
@#####.##
$salary
===================================
.
 
# 添加分页 $% 
format EMPLOYEE_TOP =
===================================
Name                    Age Page @<
                                 $%
=================================== 
.
 
select(STDOUT);
$~ = EMPLOYEE;
$^ = EMPLOYEE_TOP;
 
@n = ("Ali", "baidu", "Jaffer");
@a  = (20,30, 40);
@s = (2000.00, 2500.00, 4000.000);
 
$i = 0;
foreach (@n){
   $name = $_;
   $age = $a[$i];
   $salary = $s[$i++];
   write;
}
```

#### 输出到其他文件

默认情况下函数write将结果输出到标准输出文件STDOUT，我们也可以使它将结果输出到任意其它的文件中。最简单的方法就是把文件变量作为参数传递给write

`write(MYFILE);`

以上代码write就用默认名为MYFILE的打印格式输出到文件MYFILE中。

但是这样就不能用$~变量来改变所使用的打印格式。系统变量$~只对默认文件变量起作用，我们可以改变默认文件变量，改变$~，再调用write。

```perl
if (open(MYFILE, ">tmp")) {
$~ = "MYFORMAT";
write MYFILE; # 含文件变量的输出，此时会打印与变量同名的格式，即MYFILE。$~里指定的值被忽略。
 
format MYFILE = # 与文件变量同名 
=================================
      输入到文件中
=================================
.
close MYFILE;
}
```

我们可以使用select改变默认文件变量时，它返回当前默认文件变量的内部表示，这样我们就可以创建子程序，按自己的想法输出，又不影响程序的其它部分。

```perl
if (open(MYFILE, ">>tmp")) {
select (MYFILE); # 使得默认文件变量的打印输出到MYFILE中
$~ = "OTHER";
write;           # 默认文件变量，打印到select指定的文件中，必使用$~指定的格式 OTHER
 
format OTHER =
=================================
  使用定义的格式输入到文件中
=================================
. 
close MYFILE;
}
```

